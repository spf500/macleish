---
title: "Mini Project 3"
output: 
  html_document:
    code_folding: hide

---

```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.show = 'hold', out.width = '33%')
```

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(macleish)
library(leaflet)
library(sf)
```
MacLeish has approximately four miles of built trail for use by field station visitors. We would like to be able to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. Use the spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty. You might want to consult existing trail rating systems. It would be cool if you could create elevation profiles (e.g., this one).
Supporting data includes:
Existing trails shapefile
10’ contour elevation data

```{r, message = FALSE, warning = FALSE}
Macleish_trails <- macleish_layers %>%
  pluck("trails")
```

```{r, message = FALSE, warning = FALSE}
Contours <- macleish_layers %>%
  pluck("contours_3m")
```

```{r, message= FALSE, warning = FALSE}
trail_colors <- colorFactor("viridis", Macleish_trails %>%
                              pull(name))
```

```{r, message = FALSE, warning = FALSE}
intersections <- Macleish_trails %>%
  st_intersection(Contours)
```

```{r, message = FALSE, warning = FALSE}
initial_map <- leaflet() %>%
  addTiles %>%
  addPolylines(data = Macleish_trails, color = ~trail_colors(name), weight = 2, opacity = 1) %>%
  addPolylines(data = Contours, weight = 1) 

initial_map
```

```{r, message = FALSE, warning = FALSE}
cast_intersections <- intersections %>%
  st_cast("MULTIPOINT")%>%
  st_cast("POINT")
```

```{r, message = FALSE, warning = FALSE}
length_trails <-Macleish_trails %>%
  mutate(length = st_length(geometry)) %>%
  group_by(name) %>%
  summarise(totat_length = sum(length))

print(length_trails)
```


```{r, message = FALSE, warning = FALSE}
all_loops <- cast_intersections %>%
  select("name", "ELEV_M") %>%
  st_set_geometry(NULL)
```

```{r, message = FALSE, warning = FALSE}
elevation_profile <- function(trail_name) {
  
  all_loops %>%
    filter(name == trail_name) %>%
    mutate(id = row_number()) %>%
    ggplot(aes(x = id, y = ELEV_M)) + 
    geom_point() + 
    geom_line() + 
    expand_limits(x = c(0,50), y = c(210, 290)) +
    labs(title = trail_name)
}
```


```{r, message = FALSE, warning = FALSE}
elevation_profile("Porcupine Trail")
elevation_profile("Western Loop")
elevation_profile("Easy Out")
elevation_profile("Eastern Loop")
elevation_profile("Snowmobile Trail")
elevation_profile("Poplar Hill Road")
elevation_profile("entry trail")
elevation_profile("Driveway")
elevation_profile("Vernal Pool Loop")
```



